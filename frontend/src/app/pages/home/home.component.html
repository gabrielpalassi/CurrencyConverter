<section class="flex w-full justify-center">
  <div class="mt-5 w-full max-w-7xl px-6 py-6 lg:px-8">
    <!-- Title and description -->
    <div class="mb-12 w-full">
      <p class="text-base font-semibold text-blue-500">Global currency converter</p>
      <h1 class="text-3xl font-bold tracking-tight text-white sm:text-4xl">CurrencyConverter</h1>
      <p class="mt-1 text-lg leading-8 text-slate-400">
        Trusted and open-source global currency conversion and tracking of exchange rates.
      </p>
    </div>
    <!-- Conversion container -->
    <div class="w-full rounded-lg bg-white px-8 py-8 md:px-9">
      <div class="conversion-custom-grid flex w-full flex-col gap-4">
        <!-- Amount -->
        <currency-input
          label="Amount"
          [prefix]="conversionData.base.prefix"
          [(value)]="conversionData.value"
          [placeholder]="'0.00'"
          [(error)]="inputError"
          class="w-full">
        </currency-input>
        <!-- Base currency -->
        <app-currency-select
          label="From"
          [options]="currencyList"
          [(selectedOption)]="conversionData.base"
          class="w-full md:max-w-[283.64px]">
        </app-currency-select>
        <!-- Switch currencies button -->
        <button
          (click)="switchConversionCurrencies()"
          [disabled]="conversionIsLoading"
          class="delay-70 h-[48px] w-[48px] rounded-full text-sm text-slate-600 ring-1 ring-inset ring-slate-300 transition hover:text-slate-500 disabled:cursor-not-allowed disabled:text-slate-400 disabled:hover:text-slate-400 md:mt-8">
          <span class="hidden md:inline">&#x21C4;</span>
          <span class="inline md:hidden">&#x21C5;</span>
        </button>
        <!-- Currency to -->
        <app-currency-select
          label="To"
          [options]="currencyList"
          [(selectedOption)]="conversionData.destiny"
          class="w-full md:max-w-[283.64px]">
        </app-currency-select>
        <!-- Convert button -->
        <button
          (click)="convertCurrency()"
          [disabled]="conversionIsLoading"
          class="delay-70 h-[48px] w-full rounded-md bg-blue-600 px-3.5 text-sm font-semibold text-white shadow-sm transition hover:bg-blue-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600 disabled:cursor-not-allowed disabled:bg-blue-400 disabled:hover:bg-blue-400 md:mt-8">
          @if (conversionIsLoading) {
            <div class="flex h-full w-full items-center justify-center gap-2">
              <div class="h-4 w-4 animate-spin rounded-full border-2 border-blue-200 border-t-white"></div>
              Loading...
            </div>
          } @else {
            Convert
          }
        </button>
      </div>
      <!-- Conversion response -->
      @if (this.conversionData.response) {
        <div
          class="flex h-[124px] w-full gap-3"
          @expand>
          @if (!conversionIsLoading) {
            <!-- Data -->
            <div @fadeIn>
              <p class="mt-6 whitespace-nowrap text-base font-semibold text-slate-600">
                {{ this.conversionData.response.base.value | number: "1.2-2" }}
                {{ this.conversionData.response.base.currency.shortName }}
              </p>
              <p class="whitespace-nowrap text-2xl font-bold">
                {{ this.conversionData.response.result.value | number: "1.2-2" }}
                {{ this.conversionData.response.result.currency.shortName }}
              </p>
              <p class="mt-2 whitespace-nowrap text-xs text-slate-500">
                1 {{ this.conversionData.response.base.currency.fullName }} =
                {{
                  this.conversionData.response.result.value / this.conversionData.response.base.value | number: "1.2-2"
                }}
                {{ this.conversionData.response.result.currency.fullName }}
              </p>
              <p class="mt-1 whitespace-nowrap text-xs text-slate-500">
                1 {{ this.conversionData.response.result.currency.fullName }} =
                {{
                  this.conversionData.response.base.value / this.conversionData.response.result.value | number: "1.2-2"
                }}
                {{ this.conversionData.response.base.currency.fullName }}
              </p>
            </div>
            <!-- Chart -->
            <div
              class="flex w-full"
              @fadeIn>
              <highcharts-chart
                [Highcharts]="Highcharts"
                [options]="mainChartOptions"
                class="display:block mt-6 w-full">
              </highcharts-chart>
            </div>
          }
        </div>
      }
    </div>
  </div>
</section>
<div class="mt-10 flex w-full flex-col items-center justify-center rounded-t-4xl bg-white">
  <!-- Exchange rates table section -->
  <section
    id="exchangeRates"
    class="mt-2 min-h-144 w-full max-w-7xl px-6 py-6 lg:mt-4 lg:px-8">
    <!-- Title and description -->
    <div class="mb-7 w-full">
      <p class="text-base font-semibold text-slate-600">Stay updated</p>
      <h2 class="text-2xl font-bold tracking-tight">Major Forex Rates</h2>
    </div>
    <!-- Exchange rate table -->
    @if (!tableIsLoading) {
      <table
        class="w-full"
        @fadeIn>
        <thead>
          <tr class="text-slate-600">
            <th class="w-1/3 max-w-[33%] truncate px-4 pb-4 text-left font-semibold sm:w-auto">Currency</th>
            <th class="w-1/3 max-w-[33%] truncate px-4 pb-4 text-center font-semibold sm:w-auto">Rate</th>
            <th class="hidden truncate px-4 pb-4 text-center font-semibold sm:table-cell">Equivalence</th>
            <th class="hidden truncate px-4 pb-4 text-center font-semibold lg:table-cell">Change (24h)</th>
            <th class="w-1/3 max-w-[33%] truncate px-4 pb-4 text-right font-semibold sm:w-2/5 sm:max-w-none">
              Chart (24h)
            </th>
          </tr>
        </thead>
        <tbody>
          <!-- Base -->
          <tr class="h-19 text-white *:bg-blue-900">
            <!-- Currency -->
            <th class="rounded-l-md px-4 text-left font-semibold">
              <div class="flex items-center gap-2">
                <!-- Flag -->
                <img
                  [src]="conversionTableData.base.flag"
                  alt="Country flag"
                  class="h-6 w-6 rounded-full" />
                <!-- Currency name -->
                <div>
                  <p class="hidden truncate sm:block">{{ conversionTableData.base.fullName }}</p>
                  <p class="sm:text-xs sm:font-medium">{{ conversionTableData.base.shortName }}</p>
                </div>
              </div>
            </th>
            <!-- Rate -->
            <td class="px-4 text-center font-semibold">1.00</td>
            <!-- Equivalence -->
            <td class="hidden px-4 text-center font-semibold sm:table-cell">
              <p class="truncate text-xs">
                1 {{ conversionTableData.base.shortName }} = 1 {{ conversionTableData.base.shortName }}
              </p>
              <p class="truncate text-xs">
                1 {{ conversionTableData.base.shortName }} = 1 {{ conversionTableData.base.shortName }}
              </p>
            </td>
            <!-- Change -->
            <td class="hidden px-4 text-center font-semibold lg:table-cell">0.00%</td>
            <!-- Chart -->
            <td class="rounded-r-md px-4 text-right font-semibold"></td>
          </tr>
          <!-- Conversions -->
          @for (entry of conversionTableData.result; track entry.currency.shortName) {
            <tr
              (click)="setBaseCurrencyOfTable(entry.currency)"
              class="*:delay-70 h-19 cursor-pointer border-slate-100 text-slate-600 *:transition *:hover:bg-blue-50"
              [ngClass]="{
                'border-b-[1.5px]': entry.currency.shortName !== conversionTableData.result.at(-1)!.currency.shortName
              }">
              <!-- Currency -->
              <th class="rounded-l-md px-4 text-left font-semibold">
                <div class="flex items-center gap-2">
                  <!-- Flag -->
                  <img
                    [src]="entry.currency.flag"
                    alt="Country flag"
                    class="h-6 w-6 rounded-full" />
                  <!-- Currency name -->
                  <div>
                    <p class="hidden truncate sm:block">{{ entry.currency.fullName }}</p>
                    <p class="sm:text-xs sm:font-medium">{{ entry.currency.shortName }}</p>
                  </div>
                </div>
              </th>
              <!-- Rate -->
              <td class="px-4 text-center font-semibold">
                {{ entry.value | number: "1.2-5" }}
              </td>
              <!-- Equivalence -->
              <td class="hidden px-4 text-center font-semibold sm:table-cell">
                <p class="truncate text-xs">
                  1 {{ conversionTableData.base.shortName }} =
                  {{ entry.value | number: "1.2-2" }}
                  {{ entry.currency.shortName }}
                </p>
                <p class="truncate text-xs">
                  1 {{ entry.currency.shortName }} =
                  {{ 1 / entry.value | number: "1.2-2" }}
                  {{ conversionTableData.base.shortName }}
                </p>
              </td>
              <!-- Change -->
              <td
                class="hidden px-4 text-center font-semibold lg:table-cell"
                [ngClass]="{
                  'text-red-500': entry.dailyChange < 0,
                  'text-green-500': entry.dailyChange > 0
                }">
                @if (entry.dailyChange > 0) {
                  <span>+</span>
                }
                <span>{{ entry.dailyChange | number: "1.2-2" }}%</span>
              </td>
              <!-- Chart -->
              <td class="rounded-r-md px-4 text-right font-semibold">
                <div class="flex h-19 w-full">
                  <highcharts-chart
                    [Highcharts]="Highcharts"
                    [options]="entry.chartOptions"
                    class="display:block mt-6 w-full">
                  </highcharts-chart>
                </div>
              </td>
            </tr>
          }
        </tbody>
      </table>
    }
  </section>
</div>
